define(["@grafana/data","react","@grafana/ui","d3"],((t,e,r,n)=>(()=>{"use strict";var o={305:e=>{e.exports=t},388:t=>{t.exports=r},200:t=>{t.exports=n},650:t=>{t.exports=e}},s={};function i(t){var e=s[t];if(void 0!==e)return e.exports;var r=s[t]={exports:{}};return o[t](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{i.r(a),i.d(a,{plugin:()=>l});var t=i(305),e=i(650),r=i.n(e),n=i(388),o=i(200);const s=(0,n.withTheme2)((({options:t,data:n,width:s,height:i,theme:a})=>{const l=(0,e.useRef)(null);function d(t){return n.series.map((e=>e.fields.find((e=>e.name.toLowerCase()===t.toLowerCase())))).map((t=>null==t?void 0:t.values))[0]}return(0,e.useEffect)((()=>{if(n&&l.current){o.select("g").remove(),o.selectAll(".tooltip").remove();const t=o.select(l.current),e={left:0,top:0,right:0,bottom:0};let r=!1;const n=s+e.left+e.right,u=i+e.top+e.bottom,c=s/2+e.left,p=i/2+e.top;let g=[],y=d("srcPod");if(void 0!==y){let t=d("srcPort"),e=d("dstSvc"),r=d("dstSvcPort"),n=d("dstPod"),o=d("dstPort"),s=d("dstIP"),i=d("bytes"),a=d("revBytes"),l=d("egressNetworkPolicyName"),u=d("egressNetworkPolicyRuleAction"),c=d("ingressNetworkPolicyName"),p=d("ingressNetworkPolicyRuleAction"),f=y.length;for(let d=0;d<f;d++){let f=[],h=y[d],x=t[d],m=e[d],P=r[d];""!==m&&null!==m||("/"===n[d]||""===n[d]||null===n[d]?m=s[d]:(m=n[d],P=o[d])),f.push(h),f.push(x),f.push(m),f.push(P),f.push(i[d]),f.push(a[d]),f.push(l[d]),f.push(u[d]),f.push(c[d]),f.push(p[d]),g.push(f)}}const f=Array.from(new Set(g.flatMap((t=>[t[0],t[2]])))),h=o.scaleOrdinal(o.schemeSet3),x=new Map(f.map(((t,e)=>[t,e]))),m=Array.from(x,(()=>new Array(f.length).fill(0))),P=new Map,v=new Map([[1,"Allow"],[2,"Drop"],[3,"Reject"]]);for(let t of g){let e=t[0],r=t[1],n=t[2],o=t[3],s=t[4],i=t[5],a=t[6],l=t[7],d=t[8],u=t[9];m[x.get(e)][x.get(n)]+=s;let c=[x.get(e),x.get(n)].join(","),p={source:e,sourcePort:r,destination:n,destinationPort:o,egressNP:a,egressRuleAction:l,ingressNP:d,ingressRuleAction:u,bytes:s,reverseBytes:i};P.set(c,p)}const b="#EE4B2B",w="#228B22",A=.5*Math.min(n,u)-100,N=A+10,k=o.chordDirected().padAngle(10/A).sortSubgroups(o.descending).sortChords(o.descending),R=o.arc().innerRadius(A).outerRadius(N),M=o.ribbonArrow().radius(A-1).padAngle(1/A),S=o.select("body").append("div").attr("class","tooltip").style("opacity",0).style("position","absolute").style("z-index","10").style("background-color",a.colors.background.secondary).style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px"),j=t.attr("width",n).attr("height",u).append("g").attr("transform","translate("+c+","+p+")");j.append("rect").attr("width",n).attr("height",u).attr("transform","translate("+-c+","+-p+")").style("opacity",0).on("click",(function(){!0===r&&(E.transition().style("opacity",.8),r=!1)}));const B=k(m);j.datum(B).append("g").selectAll("g").data((function(t){return t.groups})).enter().append("g").append("path").on("mouseover",(function(t,e){if(!0===r)return;let n=e.index;E.filter((function(t){return t.source.index!==n&&t.target.index!==n})).transition().style("opacity",.1)})).on("mouseout",(function(t,e){if(!0===r)return;let n=e.index;E.filter((function(t){return t.source.index!==n&&t.target.index!==n})).transition().style("opacity",.8)})).on("click",(function(t,e){t.stopPropagation(),r=!0;let n=e.index;E.filter((function(t){return t.source.index!==n&&t.target.index!==n})).transition().style("opacity",.1)})).style("fill",(function(t){return h(f[t.index])})).style("stroke","black").attr("id",(function(t){return"group"+t.index})).attr("d",R);const O=j.append("g").selectAll("text").data(B.groups).enter().append("text").each((function(t){t.angle=(t.startAngle+t.endAngle)/2})).attr("dy",".35em").attr("text-anchor",(function(t){return t.angle>Math.PI?"end":null})).attr("transform",(function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+(A+15)+")"+(t.angle>Math.PI?"rotate(180)":"")})).attr("opacity",.9);O.append("tspan").style("fill",a.colors.text.primary).attr("x",0).attr("dy",0).text((function(t,e){let r=f[e].split("/");return void 0!==r[0]?r[0]:""})),O.append("tspan").style("fill",a.colors.text.primary).attr("x",0).attr("dy",15).text((function(t,e){let r=f[e].split("/");return void 0!==r[1]?r[1]:""}));const E=j.datum(B).append("g").selectAll("path").data((function(t){return t})).enter().append("path");E.attr("class","ribbons").attr("d",M).attr("stroke","black").style("opacity",.8).style("fill",(function(t){var e,r;const n=[t.source.index,t.target.index].join(","),o=null===(e=P.get(n))||void 0===e?void 0:e.egressRuleAction,s=null===(r=P.get(n))||void 0===r?void 0:r.ingressRuleAction;return 2===o||3===o||2===s||3===s?b:1===o||1===s?w:h(f[t.source.index])})).on("mouseover",(function(t,e){const r=[e.source.index,e.target.index].join(","),n=P.get(r);let o=n.source;0!==n.sourcePort&&(o+=":"+n.sourcePort);let s=n.destination;0!==n.destinationPort&&(s+=":"+n.destinationPort);let i='\n          <table style="margin-top: 2.5px;">\n          <tr><td>From: </td><td style="text-align: right">'+o+'</td></tr><tr><td>To: </td><td style="text-align: right">'+s;return""!==n.egressNP&&(i+='</td></tr>\n            <tr><td>Egress NetworkPolicy name: </td><td style="text-align: right">'+n.egressNP+'</td></tr>\n            <tr><td>Egress NetworkPolicy Rule Action: </td><td style="text-align: right">'+v.get(n.egressRuleAction)),""!==n.ingressNP&&(i+='</td></tr>\n            <tr><td>Ingress NetworkPolicy name: </td><td style="text-align: right">'+n.ingressNP+'</td></tr>\n            <tr><td>Ingress NetworkPolicy Rule Action: </td><td style="text-align: right">'+v.get(n.ingressRuleAction)),i+='</td></tr>\n          <tr><td>Bytes: </td><td style="text-align: right">'+n.bytes+'</td></tr>\n          <tr><td>Reverse Bytes: </td><td style="text-align: right">'+n.reverseBytes+"</td></tr>\n                  </table>\n                  ",S.style("opacity",1).html(i).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mousemove",(function(t,e){return S.style("top",t.pageY-10+"px").style("left",t.pageX+10+"px")})).on("mouseout",(function(){return S.style("opacity",0)}))}})),r().createElement("svg",{className:"d3-component",width:s,height:i,ref:l})})),l=new t.PanelPlugin(s).setPanelOptions((t=>t))})(),a})()));
//# sourceMappingURL=module.js.map